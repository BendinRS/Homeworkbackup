# Домашняя работа "Настраиваемые бэкапы"

<details>
<summary>Введение</summary>

BorgBackup это дедуплицирующая программа для резервного копирования. Опционально доступно сжатие и шифрование данных. Основная задача BorgBackup — предоставление эффективного и безопасного решения для резервного копирования. Благодаря дедупликации резервное копирование происходит очень быстро. Все данные можно зашифровать на стороне клиента, что делает Borg интересным для использования на арендованных хранилищах. 
</details>


<details>
<summary>Цель</summary>

Научиться использовать инструмент для резервного копирования.
</details>



<details>
<summary>Описание домашнего задания</summary>

**Настроить стенд Vagrant с двумя виртуальными машинами:**  
+ backup_server 
+ client.  
**Настроить удаленный бэкап каталога /etc c сервера client при помощи borgbackup. Резервные копии должны соответствовать следующим критериям:** 
+ Директория для резервных копий /var/backup. Это должна быть отдельная точка монтирования. В данном случае для демонстрации размер не принципиален, достаточно будет и 2GB;  
Репозиторий для резервных копий должен быть зашифрован ключом или паролем - на ваше усмотрение; 
+ Имя бэкапа должно содержать информацию о времени снятия бекапа;  
+ Глубина бекапа должна быть год, хранить можно по последней копии на конец месяца, кроме последних трех. Последние три месяца должны содержать копии на каждый день. Т.е. должна быть правильно настроена политика удаления старых бэкапов;  
Резервная копия снимается каждые 5 минут. Такой частый запуск в целях демонстрации;  
+ Написан скрипт для снятия резервных копий. Скрипт запускается из соответствующей Cron джобы, либо systemd timer-а - на ваше усмотрение;  
+ Настроено логирование процесса бекапа. Для упрощения можно весь вывод перенаправлять в logger с соответствующим тегом.  
</details>

### Практика

1. Созданы две роли ansible. [backup](roles/backup/) и [client](roles/client/)
2. Автоматом ВМ настраиваются до момента инициализации репозитория borg на клиенте
3. Инициализирую репозиторий  

```borg init --encryption=repokey borg@192.168.11.160:/var/backup/```  
4. Ручная проверка

```borg create --stats --list borg@192.168.11.160:/var/backup/::"etc-{now:%Y-%m-%d_%H:%M:%S}" /etc```
    
5. Результат  
    ![Альтернативный текст](https://i.ibb.co/9Y3Tx5S/1234.png)
6. Автоматизируем создание бэкапов [сервисом](roles/borg/files/borg-backup.service/) и [таймером](roles/borg/files/borg-backup.timer) borg

7. Включаем и запускаем службу таймера и сервиса
8. Проверяем работу таймера




